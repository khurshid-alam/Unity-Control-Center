AC_INIT(new-control-center)

AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(control-center, 1.3.1)

AM_MAINTAINER_MODE

dnl
dnl let applications configure for gnome
dnl
gnome_cv_use_gnome=yes


AM_ACLOCAL_INCLUDE(macros)
GNOME_INIT(capplet)
GNOME_COMPILE_WARNINGS

AC_ISC_POSIX
AC_PROG_CC
AC_STDC_HEADERS
AC_ARG_PROGRAM
AM_PROG_LIBTOOL
AM_PROG_LEX
AC_PROG_YACC

dnl utility conditional
AM_CONDITIONAL(FALSE, test "x" = "y")

ALL_LINGUAS="az ca cs da de el en_GB es et fi fr ga gl hr hu it ja ko lt nl no pl pt pt_BR ro ru sk sl sv tr uk zh_CN.GB2312 zh_TW.Big5"
AM_GNOME_GETTEXT

GNOME_XML_CHECK
XML_CFLAGS=`gnome-config --cflags xml`
AC_SUBST(XML_CFLAGS)

AM_PATH_LIBGLADE(,,"gnome")

AC_CHECK_HEADERS(dlfcn.h dl.h)
AC_CHECK_LIB(dl, dlopen, DL_LIB="-ldl",[
AC_CHECK_LIB(dld, shl_load, DL_LIB="-ldld",[
AC_CHECK_FUNCS(dlopen, DL_LIB="",
AC_MSG_ERROR(Dynamic linking is not available on this platform.  Some
apps, like panel, will not run properly.))
])])
AC_SUBST(DL_LIB)

AC_CHECK_FUNCS(usleep)
AC_CHECK_FUNCS(putenv,[AC_DEFINE(HAVE_PUTENV)])
AC_CHECK_FUNCS(setenv,[AC_DEFINE(HAVE_SETENV)])

dnl keyboard-properties-capplet
AC_CHECK_HEADERS(X11/extensions/xf86misc.h, XF86MISC_LIBS="-lXxf86misc")
AC_SUBST(XF86MISC_LIBS)

AM_PATH_LIBGLADE(,AC_MSG_ERROR([You must have LibGlade installed.]), gnome)

dnl esd-manager
have_libesd=no
AM_PATH_ESD(,have_libesd=yes,
[AC_MSG_WARN([*** \`esd-manager' will not be built ***])])
AM_CONDITIONAL(HAVE_LIBESD, test yes = $have_libesd)
if test "$have_libesd" = yes; then
	AC_DEFINE(HAVE_ESD)
	AC_DEFINE(HAVE_LIBESD)
fi

dnl session-properties
AM_CONDITIONAL(SESSION, test "$GNOME_HAVE_SM" = true)

AM_PATH_IMLIB(1.8.2, , [
echo "ERROR: Needs a system with Imlib 1.8.2 or higher"
echo "You can obtain it from:"
echo "ftp://ftp.enlightenment.org/pub/enlightenment/"
echo "ftp://www.rasterman.com/pub/enlightenment/"
echo "ftp://ftp.labs.redhat.com/pub/imlib/"
AC_MSG_ERROR([Fatal Error: no Imlib detected.])])

CFLAGS="-O2 -g -Wall $CFLAGS"

dnl
dnl CApplet, Note that the libs and all that is set up in gnome_init,
dnl but gnome_init is truly dumb and doesn't require it, so we need to
dnl do a separate check
dnl
AC_MSG_CHECKING(for capplet library)
vers=`$GNOME_CONFIG --modversion capplet`
case "x$vers" in
  xcapplet-*)
    AC_MSG_RESULT(found)
    ;;
  *)
    AC_MSG_ERROR(Did not find capplet library, you probably need to install libcapplet first)
    ;;
esac

CAPPLET_CFLAGS=`gnome-config --cflags libglade capplet gdk_pixbuf ximian_archiver`
CAPPLET_LIBS=`gnome-config --libs libglade capplet gdk_pixbuf ximian_archiver`

BG_CAPPLET_CFLAGS=`gnome-config --cflags libglade capplet gdk_pixbuf gdk_pixbuf_xlib ximian_archiver`
BG_CAPPLET_LIBS=`gnome-config --libs libglade capplet gdk_pixbuf gdk_pixbuf_xlib ximian_archiver`

ROLLBACK_CAPPLET_CFLAGS=`gnome-config --cflags libglade capplet gdk_pixbuf ximian_archiver`
ROLLBACK_CAPPLET_LIBS=`gnome-config --libs libglade capplet gdk_pixbuf ximian_archiver`

GNOMECC_CFLAGS=`gnome-config --cflags gnomeui libglade xml gdk_pixbuf capplet gnomecanvaspixbuf gtkhtml`
GNOMECC_LIBS=`gnome-config --libs gnomeui libglade xml gdk_pixbuf capplet gnomecanvaspixbuf gtkhtml`

RMHELPER_CFLAGS=`gnome-config --cflags gnomeui gnomecanvaspixbuf`
RMHELPER_LIBS=`gnome-config --libs gnomeui gnomecanvaspixbuf`

AC_SUBST(CAPPLET_CFLAGS)
AC_SUBST(CAPPLET_LIBS)

AC_SUBST(BG_CAPPLET_CFLAGS)
AC_SUBST(BG_CAPPLET_LIBS)

AC_SUBST(ROLLBACK_CAPPLET_CFLAGS)
AC_SUBST(ROLLBACK_CAPPLET_LIBS)

AC_SUBST(GNOMECC_CFLAGS)
AC_SUBST(GNOMECC_LIBS)

AC_SUBST(RMHELPER_CFLAGS)
AC_SUBST(RMHELPER_LIBS)

AC_SUBST(CFLAGS)
AC_SUBST(LDFLAGS)

AC_OUTPUT([

control-center.spec
Makefile
po/Makefile.in
new-control-center/Makefile
root-manager/Makefile
capplets/Makefile
capplets/mime-type/Makefile
capplets/desktop-links/Makefile
capplets/orbit-settings/Makefile
capplets/new-background-properties/Makefile
capplets/new-bell-properties/Makefile
capplets/new-keyboard-properties/Makefile
capplets/new-mouse-properties/Makefile
capplets/new-screensaver-properties/Makefile
capplets/new-screensaver-properties/screensavers/Makefile
capplets/new-sound-properties/Makefile
capplets/new-ui-properties/Makefile
capplets/session-properties/Makefile
capplets/theme-switcher/Makefile
capplets/url-properties/Makefile
capplets/gnome-edit-properties/Makefile
capplets/wm-properties/Makefile
capplets/wm-properties/wm-desktops/Makefile
capplets/rollback/Makefile
intl/Makefile])
